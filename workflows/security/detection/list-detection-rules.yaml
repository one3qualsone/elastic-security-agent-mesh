# =============================================================================
# Workflow: List Detection Rules
# Category: security/detection
#
# Lists detection rules from the Kibana Detection Engine API with optional
# filtering by enabled status, tags, or search query. Returns paginated
# results with rule name, ID, enabled status, severity, and MITRE mappings.
#
# Author: Security Agent Mesh
# =============================================================================
name: List Detection Rules
description: List Elastic Security detection rules with optional filters.
enabled: true

tags:
  - agent-mesh
  - detection-engineering

triggers:
  - type: manual

inputs:
  - name: page
    type: number
    description: "Page number (1-based)"
    default: 1
  - name: per_page
    type: number
    description: "Results per page"
    default: 20
  - name: sort_field
    type: string
    description: "Field to sort by (e.g., name, enabled, severity)"
    default: "name"
  - name: sort_order
    type: string
    description: "Sort order: asc or desc"
    default: "asc"
  - name: search
    type: string
    description: "Free text search across rule names and descriptions"
    required: false

steps:

  - name: list_rules
    type: kibana.request
    with:
      method: GET
      path: "/api/detection_engine/rules/_find?page={{ inputs.page }}&per_page={{ inputs.per_page }}&sort_field={{ inputs.sort_field }}&sort_order={{ inputs.sort_order }}"

  - name: output_summary
    type: console
    with:
      message: |
        Found {{ steps.list_rules.output.data.total }} rules (showing page {{ inputs.page }}, {{ inputs.per_page }} per page)

