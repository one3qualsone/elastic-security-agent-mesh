# =============================================================================
# Workflow: üìù Create Alert Note
# Category: security/detection
#
# This workflow YAML defines a manual trigger for creating an alert note in a
# security operations context. It allows users to input a note and an alert
# ID, defaulting to "Note" and "abc123," respectively. The main step involves
# persisting the note associated with a specific event ID in Kibana.
#
# Author: Elastic
# Created: 2025-11-07
# =============================================================================
version: "1"
name: üìù Create Alert Note
enabled: true

# ---------------------------------------------------------------------------
# TRIGGERS
# ---------------------------------------------------------------------------
# Defines how and when this workflow is executed. Supported trigger types:
#   - manual: Run on-demand from the Kibana UI or API
#   - scheduled: Run on a recurring schedule (every: "5m" or rrule)
#   - alert: Run automatically when a security alert is triggered
# ---------------------------------------------------------------------------
triggers:
  - type: manual

# ---------------------------------------------------------------------------
# INPUTS
# ---------------------------------------------------------------------------
# Runtime parameters provided when the workflow is triggered. Each input
# can specify:
#   - name: Unique identifier for the input
#   - type: Data type (string, number, boolean, array, object)
#   - required: Whether the input must be provided (default: false)
#   - default: Default value if not provided
# Reference inputs in steps using {{ inputs.input_name }} syntax
# ---------------------------------------------------------------------------
inputs:
  - name: note
    type: string
    default: "Note"
  - name: alertid
    type: string
    default: "abc123"

# ---------------------------------------------------------------------------
# STEPS
# ---------------------------------------------------------------------------
# The sequence of actions this workflow performs. Each step executes an
# action and can reference outputs from previous steps. Key properties:
#   - name: Unique identifier for referencing this step's output
#   - type: The action to perform (http, elasticsearch.search, foreach, etc.)
#   - with: Parameters passed to the action
#   - condition: Optional expression to conditionally run the step
#   - on-failure: Error handling configuration (retry, continue, etc.)
# Access step outputs using {{ steps.step_name.output.field }} syntax
# ---------------------------------------------------------------------------
steps:

    # -------------------------------------------------------------------------
    # STEP 1: add_note_on_arrival
    # -------------------------------------------------------------------------
    # Executes the Kibana PersistNoteRoute operation.
    # Liquid syntax used:
    # - References workflow input parameter(s)
    # -------------------------------------------------------------------------
    - name: add_note_on_arrival
      type: kibana.PersistNoteRoute
      with:
        note:
          timelineId: ""
          eventId: "{{ inputs.alertid }}"
          note: "{{ inputs.note }}"
